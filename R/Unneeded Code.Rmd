---
title: "Code I don't think I need"
author: "Callie Stephenson"
date: "2024-04-08"
output: html_document
---




```{r STOP HERE !!!}
bw_caged_PAC <-lmer(Percent_Change ~ shore_dist_m + (1 | Genotype), data = all_data %>%                     filter(Species == "Pocillopora acuta" 
                           & Cage_Uncaged == "C"))
anova(bw_caged_PAC)

data <- all_data %>% 
                     filter(Species == "Pocillopora acuta" 
                           & Cage_Uncaged == "C" 
                           & Parameter == "pc1") 
#this removes V13 because it doesn't have shore dist
ggplot(data, aes(x = X._loss, y = Percent_Change))+
  geom_point(aes(color = value))+
  scale_color_fish(option = "Coryphaena_hippurus")+
  geom_smooth(method = "lm", formula = 'y~poly(x,2)')+
  labs(title="Growth of Pocillopora acuta colonies against distance from shore")
```
So this is suggesting that distance from shore is significant, let's see if SGD is too:
```{r}
bw_caged_PAC <-lmer(Percent_Change ~ shore_dist_m + value + (1 | Genotype), data = all_data %>% 
                     filter(Species == "Pocillopora acuta" 
                           & Cage_Uncaged == "C" 
                           & Parameter == "pc1") ) 
anova(bw_caged_PAC)
```


Now that we've done our data exploration, let's make the data frame needed to build some models!

```{r starting models with megan}
#For models of only caged corals, we are running with Genotype as covariate instead of random effect
#Cannot run as random effect without singularity (as there is only one occurance of genotype for every occurence of the nutrient parameter)
#for example, see how this is singular:

bw_m1_caged_PAC <-lmer(Percent_Change ~ shore_dist_m + (1 | Genotype), data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "Pocillopora acuta" & Cage_Uncaged == "C")) 
anova(bw_m1_caged_PAC)
summary(bw_m1_caged_PAC)

##plots with megan
ggplot(all_PAC_data) +
  geom_point(data = subset(all_PAC_data, Cage_Uncaged == "C"),
             aes(x = Genotype, y = Percent_Change, color = shore_dist_m)) +
  scale_color_fish(option = "Coryphaena_hippurus")
#this shore distance looks like it could be a trend

#variance components analysis within genotype and between genotype variance
#looking at all the variance in the data, looking at the grand mean vs. the mean for the random effects
#how much is between vs within genotype variance
bw_m1_caged_PRU <-lmer(Percent_Change ~ shore_dist_m + (1 | Genotype), data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "Porites rus" & Cage_Uncaged == "C")) 
anova(bw_m1_caged_PRU)
summary(bw_m1_caged_PRU)

ggplot(all_PRU_data) +
  geom_point(data = subset(all_PRU_data, Cage_Uncaged == "C"),
             aes(x = Genotype, y = Percent_Change, color = shore_dist_m))+
  scale_color_fish(option = "Coryphaena_hippurus")
```
```{r WHY YOU GET SINGULARITY IN ACUTA, eval = FALSE, echo=FALSE}
dataPAC = all_data %>%
  filter(Parameters == "Salinity" & Species == "PAC" & Cage_Uncaged == "C")

dataPRU = all_data %>% 
  filter(Parameters == "Salinity" & Species == "PRU" & Cage_Uncaged == "C")

ggplot(dataPAC) +
  geom_point(aes(x = Genotype, y = Percent_Change, color = shore_dist_m))+
  scale_color_fish(option = "Coryphaena_hippurus")
#NEARLY NO VARIATION ATTRIBUTABLE TO GENOTYPE

ggplot(dataPRU) +
  geom_point(aes(x = Genotype, y = Percent_Change, color = shore_dist_m))+
  scale_color_fish(option = "Coryphaena_hippurus")

#Q from MJD for KE:
#if you get an estimate of 0 for your random effect what do you do
#do you keep bc the structure is important
#or do you drop because the model becomes simpler

#To move forward: drop the random effect for PAC models.
```

```{r starting models, eval = FALSE, echo=FALSE}
###
#Cannot run as random effect without singularity (as there is only one occurance of genotype for every occurence of the nutrient parameter)
bw_m1_caged_PAC <-lm(Percent_Change ~ CVSeasonal + shore_dist_m,
                  data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "PAC" & Cage_Uncaged == "C"))
anova(bw_m1_caged_PAC)

bw_m1_caged_PRU <-lmer(Percent_Change ~ CVSeasonal + shore_dist_m + (1 | Genotype),
                  data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "PRU" & Cage_Uncaged == "C"))
anova(bw_m1_caged_PRU)

#For models of all corals, we are running with Genotype as a random effect
bw_m1_PAC <- lmer(Percent_Change ~ CVSeasonal + (1 | Genotype) + Cage_Uncaged, 
                  data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "PAC"))
anova(bw_m1_PAC)

bw_m1_PRU <- lmer(Percent_Change ~ CVSeasonal + (1 | Genotype) + Cage_Uncaged, 
                  data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "PRU"))
anova(bw_m1_PRU)
summary(bw_m1_PRU)
```

Same models as before, but now with silicate instead, because the range in SiO32- was an order of magnitude higher on the reef than salinity allowing for a higher signal to noise ratio. I also used maximum silicate, as it is more indicative of the maximum amount of groundwater experienced

```{r starting models silicate, eval = FALSE, echo=FALSE}
#For models of only caged corals, we are running with Genotype as covariate instead of random effect
#Cannot run as random effect without singularity (as there is only one occurance of genotype for every occurence of the nutrient parameter)
#for example, see how this is singular:
bw_m1_caged_PAC <-lmer(Percent_Change ~ Maximum + (1 | Genotype), data = all_data %>% 
                    filter(Parameters == "Silicate_umolL" & Species == "PAC" & Cage_Uncaged == "C")) 
anova(bw_m1_caged_PAC)
                    
###
#Cannot run as random effect without singularity (as there is only one occurrence of genotype for every occurrence of the nutrient parameter)
bw_m1_caged_PAC <-lm(Percent_Change ~ Maximum + Genotype,
                  data = all_data %>% 
                    filter(Parameters == "Silicate_umolL" & 
                             Species == "PAC" & 
                             Cage_Uncaged == "C"))
anova(bw_m1_caged_PAC)

bw_m1_caged_PRU <-lm(Percent_Change ~ Maximum + Genotype,
                  data = all_data %>% 
                    filter(Parameters == "Silicate_umolL" & 
                             Species == "PRU" & 
                             Cage_Uncaged == "C"))
anova(bw_m1_caged_PRU)

#For models of all corals, we are running with Genotype as a random effect
bw_m1_PAC <- lmer(Percent_Change ~ Maximum + (1 | Genotype) + Cage_Uncaged, 
                  data = all_data %>% 
                    filter(Parameters == "Silicate_umolL" & 
                             Species == "PAC"))
anova(bw_m1_PAC)
summary(bw_m1_PAC)

bw_m1_PRU <- lmer(Percent_Change ~ Maximum + (1 | Genotype) + Cage_Uncaged, 
                  data = all_data %>% 
                    filter(Parameters == "Silicate_umolL" & 
                             Species == "PRU"))
anova(bw_m1_PRU)
summary(bw_m1_PRU)
```
This also only sees a correlation between all (not just caged) change in buoyant weight for PRU. PAC is not significant.

Now let's see those same models with symbiont counts
```{r starting models symb, eval = FALSE, echo=FALSE}
#again running with Genotype as covariate when only 
symb_m1_caged_PAC <-lm(Normalized_Symbiont_Counts ~ CVSeasonal + Genotype,
                  data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "PAC" & Cage_Uncaged == "C"))
anova(symb_m1_caged_PAC)

symb_m1_caged_PRU <-lm(Normalized_Symbiont_Counts ~ CVSeasonal + Genotype,
                  data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "PRU" & Cage_Uncaged == "C"))
anova(symb_m1_caged_PRU)

#but with all the corals we can use Genotype as random effect
symb_m1_PAC <- lmer(Normalized_Symbiont_Counts ~ CVSeasonal + (1 | Genotype) + Cage_Uncaged, 
                  data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "PAC"))
anova(symb_m1_PAC)

symb_m1_PRU <- lmer(Normalized_Symbiont_Counts ~ CVSeasonal + (1 | Genotype) + Cage_Uncaged, 
                  data = all_data %>% 
                    filter(Parameters == "Salinity" & Species == "PRU"))
anova(symb_m1_PRU)
summary(symb_m1_PRU)
```



